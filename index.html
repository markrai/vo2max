<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover, interactive-widget=resizes-content">
<title>VO2 Max Coach</title>
<meta name="theme-color" content="#0c0c0c">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="VO2 Coach">
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="styles.css">
</head>

<body>

<div class="hamburger" onclick="openModal()">☰</div>

<div class="modal-bg" id="modalBg">
  <div class="modal" style="max-width: 500px;">
    <div class="close-btn" onclick="closeModal()">✕</div>
    <div class="modal-title">Settings</div>
    
    <!-- Tab buttons -->
    <div class="tab-buttons">
      <button class="tab-button active" onclick="switchTab('personal')">Profile</button>
      <button class="tab-button" onclick="switchTab('workouts')">Workouts</button>
      <button class="tab-button" onclick="switchTab('sisu')">Sync</button>
      <button class="tab-button" onclick="switchTab('install')">Install</button>
    </div>
    
    <!-- Profile Tab -->
    <div id="personalTab" class="tab-content active">
      <div class="modal-section">
        <div class="modal-field">
          <label class="modal-label" for="weight">Weight</label>
          <input id="weight" class="modal-input" type="number" placeholder="lbs">
        </div>

        <div class="modal-field">
          <label class="modal-label" for="height">Height</label>
          <div style="display: flex; gap: 8px; flex: 1;">
            <select id="heightFeet" class="modal-input" style="flex: 1;">
              <option value="">ft</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
            </select>
            <select id="heightInches" class="modal-input" style="flex: 1;">
              <option value="">in</option>
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
            </select>
          </div>
        </div>

        <div class="modal-field">
          <label class="modal-label" for="age">Age</label>
          <input id="age" class="modal-input" type="number" placeholder="years">
        </div>

        <div class="modal-field">
          <label class="modal-label" for="sex">Sex</label>
          <select id="sex" class="modal-input">
            <option value="">Select</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>
        </div>
      </div>

      <div class="modal-section">
        <div class="modal-field">
          <label class="modal-label" for="vo2">VO₂ Max</label>
          <input id="vo2" class="modal-input" type="number" placeholder="optional">
        </div>
      </div>

      <button class="button" onclick="saveProfile()">Save Profile</button>
    </div>
    
    <!-- Workouts Tab -->
    <div id="workoutsTab" class="tab-content">
      <div id="workoutSummaryList" class="workout-summary-list">
        <div class="label" style="text-align: center; margin-bottom: 16px;">Loading workouts...</div>
      </div>
    </div>
    
    <!-- Sync Tab -->
    <div id="sisuTab" class="tab-content">
      <div id="sisuSyncContent" class="sisu-sync-content">
        <div class="label" style="text-align: center; margin-bottom: 16px;">Sync</div>
        <div class="modal-section">
          <div class="label" style="text-align: center; opacity: 0.7; margin-bottom: 20px;">
            Connect to SISU to sync HRV baseline and adjust workouts automatically.
          </div>
          <div id="sisuStatus" class="label" style="text-align: center; margin-bottom: 16px;">Not connected</div>
          <button class="button" id="sisuConnectButton" onclick="connectSISU()">Connect to SISU</button>
        </div>
        
        <div class="modal-section" style="margin-top: 24px;">
          <div class="label" style="text-align: center; opacity: 0.7; margin-bottom: 16px;">
            Heart Rate Monitor
          </div>
          <button class="button" id="connectHrButton" onclick="connectHr()">Connect HR</button>
        </div>
      </div>
    </div>
    
    <!-- Install Tab -->
    <div id="installTab" class="tab-content">
      <div id="installContent" class="install-content">
        <div class="label" style="text-align: center; margin-bottom: 16px;">Install App</div>
        <div class="modal-section">
          <div class="label" style="text-align: center; opacity: 0.7; margin-bottom: 20px;">
            Install this app on your device for a better experience and offline access.
          </div>
          <div id="installButtonContainer"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal-bg" id="cancelModalBg">
  <div class="modal">
    <div class="close-btn" onclick="closeCancelModal()">×</div>
    <div class="modal-title">Cancel Workout</div>
    <div class="label" style="text-align:center;">Pressing a goal while your workout is running cancels the session.</div>
    <div class="modal-actions">
      <button class="button" onclick="confirmCancelWorkout()">Yes, cancel it</button>
      <button class="button secondary" onclick="closeCancelModal()">Keep going</button>
    </div>
  </div>
</div>

<div class="modal-bg" id="workoutSummaryModalBg">
  <div class="modal" style="max-width: 90%; max-height: 90vh; overflow-y: auto;">
    <div class="close-btn" onclick="closeWorkoutSummaryModal()">✕</div>
    <div class="modal-title">Workout Summary</div>
    <div id="workoutSummaryContent" style="margin-top: 20px;">
      <pre id="workoutSummaryJson" style="background: #232323; padding: 16px; border-radius: 8px; overflow-x: auto; font-size: 0.85rem; white-space: pre-wrap; word-wrap: break-word;"></pre>
    </div>
    <div class="modal-actions">
      <button class="button" onclick="downloadWorkoutSummaryJson()">Download JSON</button>
      <button class="button secondary" onclick="closeWorkoutSummaryModal()">Close</button>
    </div>
  </div>
</div>

<div class="container">

<div class="section workout-main-section">
  <div style="position: relative;">
    <div id="dayDisplay" class="metric"></div>
    <button id="nextDayBtn" onclick="cycleToNextDay()">▶</button>
  </div>

  <button class="button" id="startButton" onclick="startWorkout()">Start Workout</button>

  <div id="phaseDisplay" class="phase-box"></div>

  <div class="ring-wrapper" style="position: relative;">
    <div class="ring-container">
      <svg class="ring" viewBox="0 0 120 120">
        <circle class="ring-bg" cx="60" cy="60" r="54"></circle>
        <circle class="ring-progress" id="ringProgress" cx="60" cy="60" r="54"></circle>
      </svg>
      <div class="ring-center" id="ringCenterText"></div>
    </div>

    <div id="heartContainer" class="heart-container">
      <img id="heartIcon" src="heart.png" alt="">
      <div id="hrNow" class="hr-now"></div>
      <div id="hrTarget" class="hr-target"></div>
    </div>
    <img id="activityIcon" src="" alt="" style="display: none;">
  </div>
</div>

<div id="workoutBlocks" class="work-blocks"></div>

</div>

<script src="wake-lock.js"></script>
<script src="workout-storage.js"></script>
<script src="zone-calculator.js"></script>
<script src="workout-summary.js"></script>
<script src="workout-data.js"></script>
<script src="workout-logic.js"></script>
<script src="profile.js"></script>
<script src="sisu-sync.js"></script>
<script src="ui-controls.js"></script>
<script src="main.js"></script>
<script src="pwa-install.js"></script>

</body>
</html>
